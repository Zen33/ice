import {
  createBrowserHistory,
  createHashHistory,
  createMemoryHistory,
} from 'history';
import { createMiniAppHistory } from 'miniapp-history';
import { isMiniAppPlatform } from './env';

// provide history instance
// can be used in the application through history.push()
let history;

function createHistory({ routes, customHistory, type, basename }) {
  if (customHistory) {
    history = customHistory;
  } else if (type === 'hash') {
    history = createHashHistory({ basename });
  } else if (type === 'browser') {
    history = createBrowserHistory({ basename });
  } else if (isMiniAppPlatform) {
    window.history = createMiniAppHistory(routes);
    window.location = window.history.location;
    history = window.history;
  } else {
    history = createMemoryHistory();
  }
  return history;
}

function getHistory() {
  return isMiniAppPlatform ? window.history : history;
}

export { history, getHistory, createHistory };
